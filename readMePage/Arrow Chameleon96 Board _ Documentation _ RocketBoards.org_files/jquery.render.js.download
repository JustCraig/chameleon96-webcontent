(function(e,t,n){"use strict";if(t&&t.render||e.jsviews){return}var r="v1.0.0-beta",i,a,s,f,u,o="{",l="{",p="}",c="}",g="^",d=/^(!*?)(?:null|true|false|\d[\d.]*|([\w$]+|\.|~([\w$]+)|#(view|([\w$]+))?)([\w$.^]*?)(?:[.[^]([\w$]+)\]?)?)$/g,m=/(\()(?=\s*\()|(?:([([])\s*)?(?:(\^?)(!*?[#~]?[\w$.^]+)?\s*((\+\+|--)|\+|-|&&|\|\||===|!==|==|!=|<=|>=|[<>%*:?\/]|(=))\s*|(!*?[#~]?[\w$.^]+)([([])?)|(,\s*)|(\(?)\\?(?:(')|("))|(?:\s*(([)\]])(?=\s*\.|\s*\^|\s*$)|[)\]])([([]?))|(\s+)/g,v=/[ \t]*(\r\n|\n|\r)/g,h=/\\(['"])/g,w=/['"\\]/g,x=/(?:\x08|^)(onerror:)?(?:(~?)(([\w$]+):)?([^\x08]+))\x08(,)?([^\x08]+)/gi,_=/^if\s/,b=/<(\w+)[>\s]/,y=/[\x00`><"'&]/g,k=/[\x00`><\"'&]/,C=/^on[A-Z]|^convert(Back)?$/,j=y,T=0,A=0,R={"&":"&amp;","<":"&lt;",">":"&gt;","\x00":"&#0;","'":"&#39;",'"':"&#34;","`":"&#96;"},M="html",$="data-jsv-tmpl",N={},E={template:{compile:Y},tag:{compile:X},helper:{},converter:{}},S={jsviews:r,settings:function(e){K(yt,e);I(yt._dbgMode);if(yt.jsv){yt.jsv()}},sub:{View:P,Err:J,tmplFn:ot,cvt:Z,parse:gt,extend:K,syntaxErr:ut,onStore:{},_lnk:O,_ths:U},map:et,_cnvt:Q,_tag:G,_err:ft};function U(e,t){for(var n in t.props){if(C.test(n)){e[n]=t.props[n]}}}function O(e){return e}function F(e){debugger;return e}function I(e){yt._dbgMode=e;u=e?"Unavailable (nested view): use #getIndex()":"";_t("dbg",xt.dbg=wt.dbg=e?F:O)}function J(e){this.name=(i.link?"JsViews":"JsRender")+" Error";this.message=e||this.name}function K(e,t){var n;for(n in t){e[n]=t[n]}return e}function V(e){return typeof e==="function"}(J.prototype=new Error).constructor=J;function B(e,t,n){if(!bt.rTag||e){o=e?e.charAt(0):o;l=e?e.charAt(1):l;p=t?t.charAt(0):p;c=t?t.charAt(1):c;g=n||g;e="\\"+o+"(\\"+g+")?\\"+l;t="\\"+p+"\\"+c;s="(?:(?:(\\w+(?=[\\/\\s\\"+p+"]))|(?:(\\w+)?(:)|(>)|!--((?:[^-]|-(?!-))*)--|(\\*)))"+"\\s*((?:[^\\"+p+"]|\\"+p+"(?!\\"+c+"))*?)";bt.rTag=s+")";s=new RegExp(e+s+"(\\/)?|(?:\\/(\\w+)))"+t,"g");f=new RegExp("<.*>|([^\\\\]|^)[{}]|"+e+".*"+t)}return[o,l,p,c,g]}function L(e,t){if(!t){t=e;e=n}var r,i,a,s,f=this,u=!t||t==="root";if(e){s=f.type===t?f:n;if(!s){r=f.views;if(f._.useKey){for(i in r){if(s=r[i].get(e,t)){break}}}else{for(i=0,a=r.length;!s&&i<a;i++){s=r[i].get(e,t)}}}}else if(u){while(f.parent.parent){s=f=f.parent}}else{while(f&&!s){s=f.type===t?f:n;f=f.parent}}return s}function q(){var e=this.get("item");return e?e.index:n}q.depends=function(){return[this.get("item"),"index"]};function D(){return this.index}D.depends=function(){return["index"]};function H(t){var r,i=this,a=i.linkCtx,s=(i.ctx||{})[t];if(s===n&&a&&a.ctx){s=a.ctx[t]}if(s===n){s=xt[t]}if(s){if(V(s)&&!s._wrp){r=function(){return s.apply(!this||this===e?i:this,arguments)};r._wrp=true;K(r,s)}}return r||s}function Q(e,t,r,i){var a,s,f=+r===r&&t.tmpl.bnds[r-1],u=t.linkCtx;i=i!==n&&{props:{},args:[i]};r=i||(f?f(t.data,t,S):r);s=r.args[0];if(e||f){a=u&&u.tag;if(!a){a={_:{inline:!u,bnd:f},tagName:":",cvt:e,flow:true,tagCtx:r,_is:"tag"};if(u){u.tag=a;a.linkCtx=u;r.ctx=mt(r.ctx,u.view.ctx)}bt._lnk(a)}a._er=i&&s;U(a,r);r.view=t;a.ctx=r.ctx||{};delete r.ctx;t._.tag=a;s=Z(a,a.convert||e!=="true"&&e)[0];s=f&&t._.onRender?t._.onRender(s,t,f):s;t._.tag=n}return s!=n?s:""}function Z(e,t){var n=e.tagCtx,r=n.view,i=n.args;t=t&&(""+t===t?r.getRsc("converters",t)||ft("Unknown converter: '"+t+"'"):t);i=!i.length&&!n.index?[r.data]:t?i.slice():i;if(t){if(t.depends){e.depends=bt.getDeps(e.depends,e,t.depends,t)}i[0]=t.apply(e,i)}return i}function z(e,t){var r,i,a=this;while(r===n&&a){i=a.tmpl[e];r=i&&i[t];a=a.parent}return r||S[e][t]}function G(e,t,r,i,a,s){var f,u,o,l,p,c,g,d,m,v,h,w,x,_,b,y,k,C="",j=t.linkCtx||0,T=t.ctx,A=r||t.tmpl,R=+i===i&&A.bnds[i-1];if(e._is==="tag"){f=e;e=f.tagName;i=f.tagCtxs}f=f||j.tag;s=s!==n&&(C+=s,[{props:{},args:[]}]);i=s||(R?R(t.data,t,S):i);c=i.length;for(p=0;p<c;p++){if(!p&&(!r||!f)){h=t.getRsc("tags",e)||ft("Unknown tag: {{"+e+"}}")}d=i[p];if(!j.tag||f._er){v=d.tmpl;v=d.content=v&&A.tmpls[v-1];K(d,{tmpl:(f?f:h).template||v,render:st,index:p,view:t,ctx:mt(d.ctx,T)})}if(r=d.props.tmpl){r=""+r===r?t.getRsc("templates",r)||ht(r):r;d.tmpl=r}if(!f){if(h._ctr){f=new h._ctr;w=!!f.init}else{bt._lnk(f={render:h.render})}f._={inline:!j};if(j){j.tag=f;f.linkCtx=j}if(f._.bnd=R||j.fn){f._.arrVws={}}else if(f.dataBoundOnly){ft("{^{"+e+"}} tag must be data-bound")}f.tagName=e;f.parent=l=T&&T.tag;f._is="tag";f._def=h;f.tagCtxs=i}d.tag=f;if(f.dataMap&&f.tagCtxs){d.map=f.tagCtxs[p].map}if(!f.flow){m=d.ctx=d.ctx||{};u=f.parents=m.parentTags=T&&mt(m.parentTags,T.parentTags)||{};if(l){u[l.tagName]=l}u[f.tagName]=m.tag=f}}t._.tag=f;if(!(f._er=s)){U(f,i[0]);f.rendering={};for(p=0;p<c;p++){d=f.tagCtx=f.tagCtxs[p];y=d.props;b=Z(f,f.convert);if(x=y.dataMap||f.dataMap){if(b.length||y.dataMap){_=d.map;if(!_||_.src!==b[0]||a){if(_&&_.src){_.unmap()}_=d.map=x.map(b[0],y)}b=[_.tgt]}}f.ctx=d.ctx;if(!p&&w){k=f.template;f.init(d,j,f.ctx);w=n;if(f.template!==k){f._.tmpl=f.template}if(j){j.attr=f.attr=j.attr||f.attr}}g=n;if(f.render){g=f.render.apply(f,b)}b=b.length?b:[t];g=g!==n?g:d.render(b[0],true)||(a?n:"");C=C?C+(g||""):g}delete f.rendering}f.tagCtx=f.tagCtxs[0];f.ctx=f.tagCtx.ctx;if(f._.inline&&(o=f.attr)&&o!==M){C=o==="text"?wt.html(C):""}return R&&t._.onRender?t._.onRender(C,t,R):C}function P(e,t,n,r,i,a,s,f){var o,l,p,c=this,g=t==="array",d={key:0,useKey:g?0:1,id:""+A++,onRender:f,bnds:{}};c.data=r;c.tmpl=i,c.content=s;c.views=g?[]:{};c.parent=n;c.type=t||"top";c._=d;c.linked=!!f;if(n){o=n.views;l=n._;if(l.useKey){o[d.key="_"+l.useKey++]=c;c.index=u;c.getIndex=q;p=l.tag;d.bnd=g&&(!p||!!p._.bnd&&p)}else{o.splice(d.key=c.index=a,0,c)}c.ctx=e||n.ctx}else{c.ctx=e}}P.prototype={get:L,getIndex:D,getRsc:z,hlp:H,_is:"view"};function W(e){var t,n,r,i,a,s,f;for(t in E){a=E[t];if((s=a.compile)&&(n=e[t+"s"])){for(r in n){i=n[r]=s(r,n[r],e);if(i&&(f=bt.onStore[t])){f(r,i,s)}}}}}function X(e,t,r){var i,a;if(V(t)){t={depends:t.depends,render:t}}else{if(t.baseTag){t.flow=!!t.flow;t=K(K({},t.baseTag),t)}if((a=t.template)!==n){t.template=""+a===a?ht[a]||ht(a):a}if(t.init!==false){i=t._ctr=function(){};(i.prototype=t).constructor=i}}if(r){t._parentTmpl=r}return t}function Y(r,i,a,s){function u(i){if(""+i===i||i.nodeType>0){try{l=i.nodeType>0?i:!f.test(i)&&t&&t(e.document).find(i)[0]}catch(u){}if(l){i=ht[r=r||l.getAttribute($)];if(!i){r=r||"_"+T++;l.setAttribute($,r);i=ht[r]=Y(r,l.innerHTML,a,s)}l=n}return i}}var o,l;i=i||"";o=u(i);s=s||(i.markup?i:{});s.tmplName=r;if(a){s._parentTmpl=a}if(!o&&i.markup&&(o=u(i.markup))){if(o.fn&&(o.debug!==i.debug||o.allowCode!==i.allowCode)){o=o.markup}}if(o!==n){if(r&&!a){N[r]=function(){return i.render.apply(i,arguments)}}if(o.fn||i.fn){if(o.fn){if(r&&r!==o.tmplName){i=mt(s,o)}else{i=o}}}else{i=tt(o,s);ot(o.replace(w,"\\$&"),i)}W(s);return i}}function et(e){function t(t,n){this.tgt=e.getTgt(t,n)}if(V(e)){e={getTgt:e}}if(e.baseMap){e=K(K({},e.baseMap),e)}e.map=function(e,n){return new t(e,n)};return e}function tt(e,t){var n,r=yt.wrapMap||{},a=K({markup:e,tmpls:[],links:{},tags:{},bnds:[],_is:"template",render:at},t);if(!t.htmlTag){n=b.exec(e);a.htmlTag=n?n[1].toLowerCase():""}n=r[a.htmlTag];if(n&&n!==r.div){a.markup=i.trim(a.markup)}return a}function nt(e,t){function r(a,s,f){var u,o,l,p;if(a&&typeof a==="object"&&!a.nodeType&&!a.markup&&!a.getTgt){for(l in a){r(l,a[l],s)}return S}if(s===n){s=a;a=n}if(a&&""+a!==a){f=s;s=a;a=n}p=f?f[i]=f[i]||{}:r;o=t.compile;if(s===null){a&&delete p[a]}else{s=o?s=o(a,s,f):s;a&&(p[a]=s)}if(o&&s){s._is=e}if(s&&(u=bt.onStore[e])){u(a,s,o)}return s}var i=e+"s";S[i]=r;E[e]=t}function rt(e,t,n){var r=this.jquery&&(this[0]||ft('Unknown template: "'+this.selector+'"')),i=r.getAttribute($);return at.call(i?ht[i]:ht(r),e,t,n)}function it(e,t,n){if(yt._dbgMode){try{return e.fn(t,n,S)}catch(r){return ft(r,n)}}return e.fn(t,n,S)}function at(e,t,n,r,a,s){var f=this;if(!r&&f.fn._nvw&&!i.isArray(e)){return it(f,e,{tmpl:f})}return st.call(f,e,t,n,r,a,s)}function st(e,t,r,a,s,f){var u,o,l,p,c,g,d,m,v,h,w,x,_,b,y=this,k="";if(!!t===t){r=t;t=n}if(s===true){d=true;s=0}if(y.tag){m=y;y=y.tag;h=y._;x=y.tagName;_=h.tmpl||m.tmpl;b=y.attr&&y.attr!==M,t=mt(t,y.ctx);v=m.content;if(m.props.link===false){t=t||{};t.link=false}a=a||m.view;e=arguments.length?e:a}else{_=y}if(_){if(!a&&e&&e._is==="view"){a=e}if(a){v=v||a.content;f=f||a._.onRender;if(e===a){e=a.data}t=mt(t,a.ctx)}if(!a||a.type==="top"){(t=t||{}).root=e}if(!_.fn){_=ht[_]||ht(_)}if(_){f=(t&&t.link)!==false&&!b&&f;w=f;if(f===true){w=n;f=a._.onRender}t=_.helpers?mt(_.helpers,t):t;if(i.isArray(e)&&!r){p=d?a:s!==n&&a||new P(t,"array",a,e,_,s,v,f);for(u=0,o=e.length;u<o;u++){l=e[u];c=new P(t,"item",p,l,_,(s||0)+u,v,f);g=it(_,l,c);k+=p._.onRender?p._.onRender(g,c):g}}else{if(a||!_.fn._nvw){p=d?a:new P(t,x||"data",a,e,_,s,v,f);if(h&&!y.flow){p.tag=y}}k+=it(_,e,p)}return w?w(k,p):k}}return""}function ft(e,t,n){var r=yt.onError(e,t,n);if(""+e===e){throw new bt.Err(r)}return!t.linkCtx&&t.linked?wt.html(r):r}function ut(e){ft("Syntax error\n"+e)}function ot(e,t,n,r){function i(t){t-=m;if(t){b.push(e.substr(m,t).replace(v,"\\n"))}}function a(t){t&&ut('Unmatched or missing tag: "{{/'+t+'}}" in template:\n'+e)}function f(s,f,u,o,c,d,k,j,T,A,R,$){if(d){c=":";o=M}A=A||n;var N=(f||n)&&[[]],E="",S="",U="",O="",F="",I="",J="",K="",V=!A&&!c&&!k;u=u||(T=T||"#data",c);i($);m=$+s.length;if(j){if(g){b.push(["*","\n"+T.replace(h,"$1")+"\n"])}}else if(u){if(u==="else"){if(_.test(T)){ut('for "{{else if expr}}" use "{{else expr}}"')}N=y[7];y[8]=e.substring(y[8],$);y=w.pop();b=y[2];V=true}if(T){gt(T.replace(v," "),N,t).replace(x,function(e,t,n,r,i,a,s,f){if(s){S+=a+",";O+="'"+f+"',"}else if(n){U+=r+a+",";I+=r+"'"+f+"',"}else if(t){J+=a}else{if(i==="trigger"){K+=a}E+=r+a+",";F+=r+"'"+f+"',";p=p||C.test(i)}return""}).slice(0,-1);if(N&&N[0]){N.pop()}}l=[u,o||!!r||p||"",V&&[],pt(O,F,I),pt(S,E,U),J,K,N||0];b.push(l);if(V){w.push(y);y=l;y[8]=m}}else if(R){a(R!==y[0]&&y[0]!=="else"&&R);y[8]=e.substring(y[8],$);y=w.pop()}a(!y&&R);b=y[2]}var u,l,p,g=t&&t.allowCode,d=[],m=0,w=[],b=d,y=[,,d];if(n){e=o+e+c}a(w[0]&&w[0][2].pop()[0]);e.replace(s,f);i(e.length);if(m=d[d.length-1]){a(""+m!==m&&+m[8]===m[8]&&m[0])}if(n){u=dt(d,e,n);lt(u,d[0][7])}else{u=dt(d,t)}if(u._nvw){u._nvw=!/[~#]/.test(e)}return u}function lt(e,t){e.deps=[];for(var n in t){if(n!=="_jsvto"&&t[n].length){e.deps=e.deps.concat(t[n])}}e.paths=t}function pt(e,t,n){return[e.slice(0,-1),t.slice(0,-1),n.slice(0,-1)]}function ct(e,t){return"\n	"+(t?t+":{":"")+"args:["+e[0]+"]"+(e[1]||!t?",\n	props:{"+e[1]+"}":"")+(e[2]?",\n	ctx:{"+e[2]+"}":"")}function gt(e,t,n){function r(r,m,x,_,b,y,k,C,j,T,A,R,M,$,N,E,S,U,O,F){y=y||"";x=x||m||R;b=b||j;T=T||S||"";var I,J,K,V=F.length-1;function B(e,n,r,f,u,l,p,c){if(r){if(o){if(i==="linkTo"){a=t._jsvto=t._jsvto||[];a.push(b)}if(!i||s){o.push(b.slice(n.length))}}if(r!=="."){var g=(f?'view.hlp("'+f+'")':u?"view":"data")+(c?(l?"."+l:f?"":u?"":"."+r)+(p||""):(c=f?"":u?l||"":r,""));g=g+(c?"."+c:"");return n+(g.slice(0,9)==="view.data"?g.slice(5):g)}}return e}if(k&&!u&&!f){ut(e)}else{if(o&&E&&!u&&!f){if(!i||s||a){I=h[w];if(V>O-I){I=F.slice(I,O+1);E=l+":"+I+" onerror=''"+p;K=g[E];if(!K){g[E]=true;g[E]=K=ot(E,n||o,true);K.paths.push({_jsvOb:K})}if(K!==true){(a||o).push({_jsvOb:K})}}}}return u?(u=!M,u?r:'"'):f?(f=!$,f?r:'"'):(x?(w++,h[w]=O++,x):"")+(U?w?"":(c=F.slice(c,O),i?(i=s=a=false,"\b"):"\b,")+c+(c=O+r.length,o&&t.push(o=[]),"\b"):C?(w&&ut(e),o&&t.pop(),i=b,s=_,c=O+r.length,_&&(o=t[i]=[]),b+":"):b?b.split("^").join(".").replace(d,B)+(T?(v[++w]=true,b.charAt(0)!=="."&&(h[w]=O),J?"":T):y):y?y:N?(v[w--]=false,N)+(T?(v[++w]=true,T):""):A?(v[w]||ut(e),","):m?"":(u=M,f=$,'"'))}}var i,a,s,f,u,o=t&&t[0],c=0,g=n?n.links:o&&(o.links=o.links||{}),v={},h={0:-1},w=0;return(e+(n?" ":"")).replace(/\)\^/g,").").replace(m,r)}function dt(e,t,r){var i,a,s,f,u,o,l,p,c,g,d,m,h,w,x,_,b,y,k,C,j,T,A,R,$,N,E,S,U,O,F,I=0,J="",K={},V=e.length;if(""+t===t){k=r?'data-link="'+t.replace(v," ").slice(1,-1)+'"':t;t=0}else{k=t.tmplName||"unnamed";if(t.allowCode){K.allowCode=true}if(t.debug){K.debug=true}m=t.bnds;y=t.tmpls}for(i=0;i<V;i++){a=e[i];if(""+a===a){J+='\n+"'+a+'"'}else{s=a[0];if(s==="*"){J+=";\n"+a[1]+"\nret=ret"}else{f=a[1];T=a[2];u=ct(a[3],"params")+"},"+ct(w=a[4]);U=a[5];F=a[6];A=a[8];if(!(N=s==="else")){I=0;if(m&&(h=a[7])){I=m.push(h)}}if(E=s===":"){if(f){s=f===M?">":f+s}}else{if(T){C=tt(A,K);C.tmplName=k+"/"+s;dt(T,C);y.push(C)}if(!N){j=s;$=J;J=""}R=e[i+1];R=R&&R[0]==="else"}O=U?";\ntry{\nret+=":"\n+";x="";_="";if(E&&(h||F||f&&f!==M)){S="return {"+u+"};";b='c("'+f+'",view,';S=new Function("data,view,j,u"," // "+k+" "+I+" "+s+"\n"+S);S._er=U;x=b+I+",";_=")";S._tag=s;if(r){return S}lt(S,h);d=true}J+=E?(r?(U?"\ntry{\n":"")+"return ":O)+(d?(d=n,g=c=true,b+(h?(m[I-1]=S,I):"{"+u+"}")+")"):s===">"?(l=true,"h("+w[0]+")"):(p=true,"((v="+w[0]+')!=null?v:"")')):(g=o=true,"\n{view:view,tmpl:"+(T?y.length:"0")+","+u+"},");if(j&&!R){J="["+J.slice(0,-1)+"]";b='t("'+j+'",view,this,';if(r||h){J=new Function("data,view,j,u"," // "+k+" "+I+" "+j+"\nreturn "+J+";");J._er=U;J._tag=s;if(h){lt(m[I-1]=J,h)}if(r){return J}x=b+I+",undefined,";_=")"}J=$+O+b+(I||J)+")";h=0;j=0}if(U){g=true;J+=";\n}catch(e){ret"+(r?"urn ":"+=")+x+"j._err(e,view,"+U+")"+_+";}\n"+(r?"":"ret=ret")}}}}J="// "+k+"\nvar v"+(o?",t=j._tag":"")+(c?",c=j._cnvt":"")+(l?",h=j.converters.html":"")+(r?";\n":',ret=""\n')+(K.debug?"debugger;":"")+J+(r?"\n":";\nreturn ret;");try{J=new Function("data,view,j,u",J)}catch(B){ut("Compiled template code:\n\n"+J+'\n: "'+B.message+'"')}if(t){t.fn=J}if(!g){J._nvw=true}return J}function mt(e,t){return e&&e!==t?t?K(K({},t),e):e:t&&K({},t)}function vt(e){return R[e]||(R[e]="&#"+e.charCodeAt(0)+";")}for(a in E){nt(a,E[a])}var ht=S.templates,wt=S.converters,xt=S.helpers,_t=S.tags,bt=S.sub,yt=S.settings;if(t){i=t;i.fn.render=rt;if(i.observable){K(bt,i.views.sub);S.map=i.views.map}}else{i=e.jsviews={};i.isArray=Array&&Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"}}i.render=N;i.views=S;i.templates=ht=S.templates;yt({debugMode:I,delimiters:B,onError:function(e,t,r){if(t){e=r===n?"{Error: "+e+"}":V(r)?r(e,t):r}return e==n?"":e},_dbgMode:true});_t({"else":function(){},"if":{render:function(e){var t=this,n=t.rendering.done||!e&&(arguments.length||!t.tagCtx.index)?"":(t.rendering.done=true,t.selected=t.tagCtx.index,t.tagCtx.render(t.tagCtx.view,true));return n},onUpdate:function(e,t,n){var r,i,a;for(r=0;(i=this.tagCtxs[r])&&i.args.length;r++){i=i.args[0];a=!i!==!n[r].args[0];if(!this.convert&&!!i||a){return a}}return false},flow:true},"for":{render:function(e){var t,r=this,a=r.tagCtx,s="",f=0;if(!r.rendering.done){if(t=!arguments.length){e=a.view.data}if(e!==n){s+=a.render(e,t);f+=i.isArray(e)?e.length:1}if(r.rendering.done=f){r.selected=a.index}}return s},flow:true},include:{flow:true},"*":{render:O,flow:true}});function kt(e){var t,n,r=[];if(typeof e==="object"){for(t in e){n=e[t];if(!n||!n.toJSON||n.toJSON()){if(!V(n)){r.push({key:t,prop:n})}}}}return r}_t("props",{baseTag:_t["for"],dataMap:et(kt)});function Ct(e){return e!=null?k.test(e)&&(""+e).replace(j,vt)||e:""}wt({html:Ct,attr:Ct,url:function(e){return e!=n?encodeURI(""+e):e===null?e:""}});B()})(this,this.jQuery);