(function(e,t,i,n){function r(e){return t.getElementById(e)}i.runtimes.Html4=i.addRuntime("html4",{getFeatures:function(){return{multipart:true,triggerDialog:i.ua.gecko&&e.FormData||i.ua.webkit}},init:function(n,o){n.bind("Init",function(o){var s=t.body,a,d="javascript",u,l,f,c=[],m=/MSIE/.test(navigator.userAgent),g=[],p=o.settings.filters,v,b,h,y;e:for(v=0;v<p.length;v++){b=p[v].extensions.split(/,/);for(y=0;y<b.length;y++){if(b[y]==="*"){g=[];break e}h=i.mimeTypes[b[y]];if(h&&i.inArray(h,g)===-1){g.push(h)}}}g=g.join(",");function E(){var e,a,d,u;f=i.guid();c.push(f);e=t.createElement("form");e.setAttribute("id","form_"+f);e.setAttribute("method","post");e.setAttribute("enctype","multipart/form-data");e.setAttribute("encoding","multipart/form-data");e.setAttribute("target",o.id+"_iframe");e.style.position="absolute";a=t.createElement("input");a.setAttribute("id","input_"+f);a.setAttribute("type","file");a.setAttribute("accept",g);a.setAttribute("size",1);u=r(o.settings.browse_button);if(o.features.triggerDialog&&u){i.addEvent(r(o.settings.browse_button),"click",function(e){if(!a.disabled){a.click()}e.preventDefault()},o.id)}i.extend(a.style,{width:"100%",height:"100%",opacity:0,fontSize:"99px",cursor:"pointer"});i.extend(e.style,{overflow:"hidden"});d=o.settings.shim_bgcolor;if(d){e.style.background=d}if(m){i.extend(a.style,{filter:"alpha(opacity=0)"})}i.addEvent(a,"change",function(t){var s=t.target,d,l=[],c;if(s.value){r("form_"+f).style.top=-1048575+"px";d=s.value.replace(/\\/g,"/");d=d.substring(d.length,d.lastIndexOf("/")+1);l.push(new i.File(f,d));if(!o.features.triggerDialog){i.removeAllEvents(e,o.id)}else{i.removeEvent(u,"click",o.id)}i.removeEvent(a,"change",o.id);E();if(l.length){n.trigger("FilesAdded",l)}}},o.id);e.appendChild(a);s.appendChild(e);o.refresh()}function _(){var n=t.createElement("div");n.innerHTML='<iframe id="'+o.id+'_iframe" name="'+o.id+'_iframe" src="'+d+':&quot;&quot;" style="display:none"></iframe>';a=n.firstChild;s.appendChild(a);i.addEvent(a,"load",function(t){var n=t.target,r,s;if(!u){return}try{r=n.contentWindow.document||n.contentDocument||e.frames[n.id].document}catch(a){o.trigger("Error",{code:i.SECURITY_ERROR,message:i.translate("Security error."),file:u});return}s=jQuery(r.body.innerHTML).html();if(s){u.status=i.DONE;u.loaded=1025;u.percent=100;o.trigger("UploadProgress",u);o.trigger("FileUploaded",u,{response:s})}},o.id)}if(o.settings.container){s=r(o.settings.container);if(i.getStyle(s,"position")==="static"){s.style.position="relative"}}o.bind("UploadFile",function(e,n){var o,s;if(n.status==i.DONE||n.status==i.FAILED||e.state==i.STOPPED){return}o=r("form_"+n.id);s=r("input_"+n.id);s.setAttribute("name",e.settings.file_data_name);o.setAttribute("action",e.settings.url);i.each(i.extend({name:n.target_name||n.name},e.settings.multipart_params),function(e,n){var r=t.createElement("input");i.extend(r,{type:"hidden",name:n,value:e});o.insertBefore(r,o.firstChild)});u=n;r("form_"+f).style.top=-1048575+"px";o.submit()});o.bind("FileUploaded",function(e){e.refresh()});o.bind("StateChanged",function(t){if(t.state==i.STARTED){_()}else if(t.state==i.STOPPED){e.setTimeout(function(){i.removeEvent(a,"load",t.id);if(a.parentNode){a.parentNode.removeChild(a)}},0)}i.each(t.files,function(e,t){if(e.status===i.DONE||e.status===i.FAILED){var n=r("form_"+e.id);if(n){n.parentNode.removeChild(n)}}})});o.bind("Refresh",function(e){var n,o,s,a,d,u,l,c,m;n=r(e.settings.browse_button);if(n){d=i.getPos(n,r(e.settings.container));u=i.getSize(n);l=r("form_"+f);c=r("input_"+f);i.extend(l.style,{top:d.y+"px",left:d.x+"px",width:u.w+"px",height:u.h+"px"});if(e.features.triggerDialog){if(i.getStyle(n,"position")==="static"){i.extend(n.style,{position:"relative"})}m=parseInt(n.style.zIndex,10);if(isNaN(m)){m=0}i.extend(n.style,{zIndex:m});i.extend(l.style,{zIndex:m-1})}s=e.settings.browse_button_hover;a=e.settings.browse_button_active;o=e.features.triggerDialog?n:l;if(s){i.addEvent(o,"mouseover",function(){i.addClass(n,s)},e.id);i.addEvent(o,"mouseout",function(){i.removeClass(n,s)},e.id)}if(a){i.addEvent(o,"mousedown",function(){i.addClass(n,a)},e.id);i.addEvent(t.body,"mouseup",function(){i.removeClass(n,a)},e.id)}}});n.bind("FilesRemoved",function(e,t){var i,n;for(i=0;i<t.length;i++){n=r("form_"+t[i].id);if(n){n.parentNode.removeChild(n)}}});n.bind("DisableBrowse",function(e,i){var n=t.getElementById("input_"+f);if(n){n.disabled=i}});n.bind("Destroy",function(e){var n,o,a,d={inputContainer:"form_"+f,inputFile:"input_"+f,browseButton:e.settings.browse_button};for(n in d){o=r(d[n]);if(o){i.removeAllEvents(o,e.id)}}i.removeAllEvents(t.body,e.id);i.each(c,function(e,t){a=r("form_"+e);if(a){s.removeChild(a)}})});E()});o({success:true})}})})(window,document,plupload);