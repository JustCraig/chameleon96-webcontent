var bottomBarHeight=-1;(function(t){t.tabpane={build:function(a){var e=t.extend({},t.tabpane.defaults,a),i;return this.each(function(){var a=t(this),n=t.extend({},e,a.metadata()),f,o,r;function s(){var e=window.location.hash.replace(/^.*#/,"");if(typeof i!==undefined&&i==e){return}i=e;a.find("> .jqTab").filter(function(a){if(e==""){return a+1==n.select||t(this).hasClass(n.select)}else{return"!"+this.id==e}}).each(function(){t.tabpane.switchTab(a,n,this.id)})}if(!a.is(".jqTabPaneInitialized")){a.addClass("jqTabPaneInitialized");f=a;t('<span class="foswikiClear"></span>').prependTo(a);o=t('<ul class="jqTabGroup"></ul>').prependTo(a);r=1;a.find("> .jqTab").each(function(){var e=t(this),i=e.find("h2:first").remove().html();o.append('<li><a href="#" data="'+this.id+'">'+i+"</a></li>");e.data("hash","!"+this.id);if(r==n.select||t(this).hasClass(n.select)){t.tabpane.switchTab(a,n,this.id)}r++});if(n.autoMaxExpand){t.tabpane.autoMaxExpand(a,n)}a.find(".jqTabGroup > li > a").click(function(){var e=t(this).attr("data");t(this).blur();if(e!=n.currentTabId){t.tabpane.switchTab(a,n,e)}return false});s();t(window).bind("hashchange",function(){s()})}})},switchTab:function(a,e,i){var n=e.currentTabId,f=t("#"+i),o=t("#"+n),r=f.find(".jqTabContents:first"),s=o.find(".jqTabContents:first"),d=s.height(),h,u,c;if(n==i){return}o.removeClass("current");f.addClass("current");a.find("li a[data="+n+"]").parent().removeClass("current");a.find("li a[data="+i+"]").parent().addClass("current");if(!e[i]){e[i]=f.metadata()}h=e[i];if(typeof h.beforeHandler=="function"){h.beforeHandler.call(this,n,i)}if((e.animate||e.autoMaxExpand)&&d>0){r.height(d)}u=r;c=false;if(typeof h.container!="undefined"){u=r.find(h.container);if(u.length){c=true}else{u=r}}function l(){var a="none",f;if(d>0){a="easeInOutQuad"}if(e.autoMaxExpand){if(e.animate&&a!="none"){u.css({opacity:0}).animate({opacity:1},300)}}else{if(e.animate){if(a!="none"){r.height("auto");f=r.height();if(c){r.height(d).animate({height:f},300,a,function(){r.height("auto")});u.css({opacity:0}).animate({opacity:1},300,a)}else{r.height(d).css({opacity:0}).animate({opacity:1,height:f},300,a,function(){r.height("auto")})}}}}t(window).trigger("resize");if(typeof h.afterHandler=="function"){h.afterHandler.call(this,n,i)}e.currentTabId=i}if(typeof h.url!="undefined"){u.load(h.url,undefined,function(){if(typeof h.afterLoadHandler=="function"){h.afterLoadHandler.call(this,n,i)}l()});delete e[i].url}else{l()}},autoMaxExpand:function(a,e){window.setTimeout(function(){t.tabpane.fixHeight(a,e);t(window).one("resize.tabpane",function(){t.tabpane.autoMaxExpand(a,e)})},100)},fixHeight:function(a,e){var i=a.find("> .jqTab.current .jqTabContents:first"),n=i.offset(),f,o,r,s;if(typeof n=="undefined"){return}f=n.top;if(bottomBarHeight<=0){bottomBarHeight=t(".natEditBottomBar").outerHeight(true)+parseInt(i.css("padding-bottom"),10)*2.5}o=t(window).height();if(!o){o=window.innerHeight}r=o-f-bottomBarHeight;s=t("#DEBUG");if(s.length){r-=s.outerHeight(true)}if(e&&e.minHeight&&r<e.minHeight){r=e.minHeight}if(r<0){return}t.log("TABPANE: fixHeight height=",r);i.height(r)},defaults:{select:1,animate:false,autoMaxExpand:false,minHeight:230}};t.fn.tabpane=t.tabpane.build;t(function(){t(".jqTabPane:not(.jqInitedTabpane)").livequery(function(){var a=t(this);a.addClass("jqInitedTabpane");a.tabpane()})})})(jQuery);